---
title: Bestemme den optimale kombinasjonen av overlappende rabatter
description: "Når rabatter overlapper hverandre, må du bestemme kombinasjonen av overlappende rabatter som vil produsere totalen for transaksjonen laveste eller høyeste sluttrabatten. Når rabattbeløpet varierer i henhold til prisen for produkter som er kjøpt, for eksempel som i vanlige &quot;Kjøp 1, får 1 X prosent&quot; (BOGO) retail rabatt, denne prosessen blir et problem for optimalisering av combinatorial."
author: kfend
manager: AnnBe
ms.date: 04/04/2017
ms.topic: article
ms.prod: 
ms.service: Dynamics365Operations
ms.technology: 
audience: Application User, IT Pro
ms.reviewer: kfend
ms.search.scope: AX 7.0.0, Operations, Core
ms.custom: 89643
ms.assetid: 09843c9a-3e19-4e4a-a8ce-80650f2095f9
ms.search.region: global
ms.search.industry: Retail
ms.author: kfend
ms.search.validFrom: 2016-05-31
ms.dyn365.ops.version: AX 7.0.1
translationtype: Human Translation
ms.sourcegitcommit: 0c6a7bdc4ba82dd57ab3e395e6dfb0ae4de31fc4
ms.openlocfilehash: 31e5104045ed5b8fbfa3677a7f5702d551de4231
ms.lasthandoff: 03/31/2017


---

# <a name="determine-the-optimal-combination-of-overlapping-discounts"></a>Bestemme den optimale kombinasjonen av overlappende rabatter

Når rabatter overlapper hverandre, må du bestemme kombinasjonen av overlappende rabatter som vil produsere totalen for transaksjonen laveste eller høyeste sluttrabatten. Når rabattbeløpet varierer i henhold til prisen for produkter som er kjøpt, for eksempel som i vanlige "Kjøp 1, får 1 X prosent" (BOGO) retail rabatt, denne prosessen blir et problem for optimalisering av combinatorial.

Denne artikkelen gjelder for Microsoft Dynamics AX 2012 R3 med KB 3105973 (utgitt 2 November 2015) eller senere, og i februar-2016 utgitt av Microsoft Dynamics AX. For å fastslå sammen overlappende rabatter gjelder i tide og fortsette å gi rik discounting funksjonalitet som er tilgjengelig i Microsoft Dynamics AX for Retail, har vi innført en metode for å bruke overlappende rabatter. Vi kaller denne nye metoden **rangering marginal verdien**. Rangering for marginal verdi brukes når tiden som er nødvendig for å evaluere de mulige kombinasjonene av rabatter overlappende overskrider en terskel som kan konfigureres på den **parametere for detaljhandel** siden i Dynamics AX. I marginal verdien rangering metoden, beregnes en verdi for hver overlappende rabatt ved hjelp av rabatt verdien delt-produkter. Overlappende rabatter brukes deretter fra den høyeste verdien i forhold til laveste relative verdi. Opplysninger om den nye metoden, kan du se delen "Marginal verdi" senere i denne artikkelen. Marginal verdien rangeringen er ikke brukt når rabattbeløp for et produkt ikke er berørt av et annet produkt i transaksjonen. Denne metoden er ikke for eksempel brukes til to enkle rabatter, eller en enkel rabatt og et enkelt produkt kvantumsrabatt.

## <a name="discount-examples"></a>Rabatt-eksempler
Du kan opprette et ubegrenset antall retail rabatter på et felles sett med produkter i Dynamics AX. Men fordi det er ingen grense, ytelsesproblemer kan oppstå når du prøver å beregne rabatter som skal brukes på de ulike produktene. Følgende eksempler illustrerer problemet mer detaljert. I eksempel 1 starter vi med to produkter og to overlappende rabatter. Deretter, i eksempel 2, viser vi hvordan problemet utvikler seg som flere produkter blir lagt til.

### <a name="example-1-two-products-and-two-discounts"></a>Eksempel 1: To produkter og to rabatter

I dette eksemplet to produktene er nødvendig for å kvalifisere for hver rabatt og rabattene kan ikke kombineres. Rabatter i dette eksemplet er **beste pris** rabatter. Begge produkter som er kvalifisert for begge rabatter. Her er de to rabattene. [![Overlappende rabatt combo 01](./media/overlapping-discount-combo-01.jpg)](./media/overlapping-discount-combo-01.jpg) alle to produkter, jo bedre av disse to rabattene avhenger priser for de to produktene. Når prisen på begge produktene er lik eller nesten lik, er rabatt 1 bedre. Når prisen på et produkt er betydelig mindre enn prisen på det andre produktet, er rabatt 2 bedre. Her er den matematiske regelen for å evaluere disse to rabattene mot hverandre: [![Overlapping rabatt combo 02](./media/overlapping-discount-combo-02.jpg)](./media/overlapping-discount-combo-02.jpg) Vær oppmerksom på at når prisen på produktet 1 er lik to tredjedeler av prisen på produktet 2, de to rabattene er like. I dette eksemplet varierer effektive rabattprosenten for diskonto 1 fra noen få prosent (når prisene på de to produktene er langt fra hverandre) til maksimalt 25 prosent (når de to produktene har samme pris). Effektiv rabattprosenten for diskonto 2 er løst. Det er alltid 20 prosent. Fordi den effektive rabattprosenten for diskonto 1 har et område som kan være mer enn eller mindre enn 2 for kontantrabatt, avhenger av beste rabatt priser for de to produktene må være DISKONTERT. I dette eksemplet er beregningen fullføres raskt, fordi bare to rabatter trer i kraft på bare to produktene. Det er bare to mulige kombinasjoner: ett program for rabatt 1 eller ett program av rabatt 2. Det finnes ingen permutasjoner til å beregne. Verdien av hver rabatten beregnes ved å bruke begge produktene, og den beste rabatten brukes.

### <a name="example-2-four-products-and-two-discounts"></a>Eksempel 2: Fire produktene og to rabatter

Deretter bruker vi fire produktene og de samme to rabattene. Alle fire produkter som kvalifiserer for begge rabatter. Det er tolv mulige kombinasjoner. I siste to rabattene gjelder transaksjonen i en av tre kombinasjoner: to programmer av rabatt 1, to applikasjoner for rabatt 2 eller ett bruk av rabatt 1 og ett bruk av rabatt 2. For å illustrere de mulige kombinasjonene, skal vi se på to forskjellige sett med fire produktene som har ulike priser:

-   Alle fire produkter har samme pris, $15.00. I dette tilfellet er den beste kombinasjonen av rabatt to applikasjoner for rabatten 1. To produktene vil være full pris, og to vil være 50 prosent av. Rabatterte totalbeløpet for transaksjonen er $45 (15 + 15 + 7,50 + 7,50), som er $15 (25 prosent) av den undiscounted summen av $60. Rabatt 2 er bare $12 (20 prosent).
-   To produktene er $20 hver og ett produkt er $15 ett produkt er $5. I dette tilfellet er den beste kombinasjonen av rabatt ett program av programmet rabatten 2 og en rabatt 1. Tabellene nedenfor illustrerer rabattene.

Hvis du vil lese tabellene, kan du bruke et produkt fra en rad og ett produkt fra en kolonne. For eksempel, i tabellen for diskonto 1 får når du kombinerer de to $20-produktene du $10. I tabellen for diskonto 2 når du kombinerer produkt for $15 og $5-produkter får du $4. [![Overlappende rabatt combo 03](./media/overlapping-discount-combo-03.jpg)](./media/overlapping-discount-combo-03.jpg) først, finner den største rabatten som er tilgjengelig fra en hvilken som helst to produkter ved hjelp av enten rabatt. De to tabellene vises rabattbeløpet for alle kombinasjoner av de to produktene. De skyggelagte delene tabellene representerer enten tilfeller der et produkt er forbundet med seg selv, som vi ikke kan gjøre, eller en omvendt sammenkobling av to produkter som gir den samme rabattbeløp og kan ignoreres. Ved å se på tabellene, kan du se at rabatten 1 for de to elementene i $20 er den største rabatten som er tilgjengelig for en rabatt på alle fire produkter. (Denne rabatten er uthevet i grønt i den første tabellen.) Som forlater bare $15-produkt og i $5. Ved å se på de to tabellene på nytt, kan du se at i disse to produktene rabatt 1 gir en rabatt for $2.50, mens rabatt 2 gir en rabatt på $4. Derfor velger vi rabatt 2. Den totale rabatten er $14. Hvis du vil gjøre det enklere å visualisere denne diskusjonen, er her to andre tabeller Vis effektive rabattprosenten for alle mulige to produkt-kombinasjoner for begge rabatt 1 og 2 for kontantrabatt. Bare halvparten listen over kombinasjoner er inkludert, fordi ordren der de to produktene inn rabatten uten betydning for disse to rabattene. Høyeste effektive rabatten (25 prosent), er uthevet i grønt, og den laveste effektive rabatten (10 prosent) er uthevet i rødt. [![Overlappende rabatt combo 04](./media/overlapping-discount-combo-04.jpg)](./media/overlapping-discount-combo-04.jpg)**notat:** når prisene varierer, og konkurrere i to eller flere rabatt, er den eneste måten å garantere de beste kombinasjonene av rabatter til å evaluere begge rabatter og sammenligne dem.

## <a name="total-possible-combinations"></a>Totalt antall mulige kombinasjoner
Denne delen fortsetter for eksempel fra den forrige delen. Vi vil legge til flere produkter og en annen rabatt, og se hvor mange kombinasjoner må beregnes og sammenlignes. Tabellen nedenfor viser hvor mange mulige kombinasjonene av rabatter som produktet antallet øker. Den tabell viser hva som skjer både når det er to overlappende rabatter, som i forrige eksempel, og tre overlappende rabatter. Antall mulige kombinasjonene av rabatter som må evalueres overskrider snart Hva med en rask datamaskin kan beregne og sammenligne raskt nok til å være akseptabel for handelstransaksjoner. [![Overlappende rabatt combo 05](./media/overlapping-discount-combo-05.jpg)](./media/overlapping-discount-combo-05.jpg) selv når store mengder eller flere overlappende rabatter trer i kraft, totalt antall mulige kombinasjonene av rabatter går raskt til millionene og tiden som er nødvendig for å vurdere og velge den beste mulige kombinasjonen raskt blir synlig. Noen optimaliseringer har blitt gjort i retail pris-motor for å redusere det totale antallet kombinasjoner som må evalueres. Fordi det ikke er begrenset til nummer overlappende rabatter og antallene i en transaksjon, har imidlertid alltid et stort antall kombinasjoner som skal evalueres når overlappende rabatter. Dette problemet er som marginal verdien rangering metoden løser problemet.

## <a name="marginal-value-method"></a>Metode for marginal verdi
Hvis du vil løse problemet med et eksponentielt økende antall kombinasjoner som må evalueres, finnes det en underklasse av LogicalElement som beregner verdien per delte produkt for hver rabatt på sett med produkter som to eller flere rabatter som kan brukes på. Vi henviser til denne verdien som det **marginal verdien** rabattbeløpet for produktene som er delt. Marginal verdien er gjennomsnitt per produkt økning i det totale rabattbeløpet når delte produktene som er inkludert i hver rabatt. Marginal verdien beregnes ved å trekke det totale rabattbeløpet (DTotal), å trekke rabattbeløpet uten delte produkter (DMinus\\ delt), og at denne differansen med antall delte produkter (ProductsShared). [![Overlappende rabatt combo 06](./media/overlapping-discount-combo-06.jpg)](./media/overlapping-discount-combo-06.jpg) etter marginal verdien av hver rabatt på et delt sett med produkter er beregnet, rabattene som brukes til delte produktene i rekkefølge, utførlig, fra høyeste marginal verdien til den laveste verdien for marginal. Alle gjenværende rabatt-mulighetene er ikke sammenlignet hver gang etter en enkelt forekomst av en rabatt som er brukt for denne metoden. I stedet er overlappende rabatter sammenlignet med én gang, og brukes deretter i rekkefølge. Ingen flere sammenligninger er ferdig. Du kan konfigurere grenseverdi til å bytte til metoden marginal verdien den **rabatt** -kategorien i den **parametere for detaljhandel** siden. Akseptabel tid til å beregne den totale rabatten varierer på tvers av bransjer for detaljhandel. Nå er imidlertid vanligvis mellom titalls millisekunder til ett sekund.


